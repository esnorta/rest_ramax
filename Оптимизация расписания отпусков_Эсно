{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Duck or Huck"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import numpy as np"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "from ortools.linear_solver import pywraplp"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "path = '/Users/timmac/Projects/Hacks/Ramax/vacation/'\n",
    "input_file = 'input_vacation.xlsx'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "quals = pd.read_excel(path + input_file, \\\n",
    "                      sheet_name=1, header=None, names=['quals'],\n",
    "                     engine='openpyxl')\n",
    "quals.index += 1 \n",
    "##\n",
    "p_lvl = pd.read_excel(path + input_file, \\\n",
    "                      sheet_name=2, header=None, names=['pers', 'lvl'], \n",
    "                      engine='openpyxl')\n",
    "p_lvl.index += 1 \n",
    "##\n",
    "months =  pd.read_excel(path + input_file, \\\n",
    "                      sheet_name=3, header=None, names=['mon', 'top_m', 'hours'], \n",
    "                        engine='openpyxl')\n",
    "months.index += 1 \n",
    "##\n",
    "q_lvl = pd.read_excel(path + input_file, \\\n",
    "                      sheet_name=4, header=None, names=['q_lvl'],  \n",
    "                        engine='openpyxl')\n",
    "q_lvl.index += 1 \n",
    "##\n",
    "max_f = pd.read_excel(path + input_file, \\\n",
    "                      sheet_name=5, header=None, names=['work_h'],  \n",
    "                        engine='openpyxl')\n",
    "max_f.index += 1\n",
    "##\n",
    "q_fied = pd.read_excel(path + input_file, \\\n",
    "                      sheet_name=6, header=None,  \n",
    "                        engine='openpyxl') \n",
    "q_fied.index += 1 \n",
    "##\n",
    "r_pers = pd.read_excel(path + input_file, \\\n",
    "                      sheet_name=7, header=None,  \n",
    "                        engine='openpyxl')\n",
    "r_pers.index += 1 \n",
    "##\n",
    "wishes = pd.read_excel(path + input_file, \\\n",
    "                      sheet_name=8, header=None,  \n",
    "                        engine='openpyxl')\n",
    "wishes.index += 1 \n",
    "wishes.columns=['m_1','m_2','m_3','m_4','m_5','m_6','m_7','m_8','m_9','m_10','m_11','m_12']\n",
    "##\n",
    "r_prior = pd.read_excel(path + input_file, \\\n",
    "                      sheet_name=9, header=None,  \n",
    "                        engine='openpyxl')\n",
    "r_prior.index += 1\n",
    "r_prior.columns=['m_1','m_2','m_3','m_4','m_5','m_6','m_7','m_8','m_9','m_10','m_11','m_12']\n",
    "##\n",
    "starts = pd.read_excel(path + input_file, \\\n",
    "                      sheet_name=10, header=None, names=['str'],  \n",
    "                        engine='openpyxl')\n",
    "starts.index += 1 \n",
    "##\n",
    "m_starts = pd.read_excel(path + input_file, \\\n",
    "                      sheet_name=10, header=None, names=['max_str'],  \n",
    "                        engine='openpyxl')\n",
    "m_starts.index += 1 "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>1</th>\n",
       "      <th>2</th>\n",
       "      <th>3</th>\n",
       "      <th>4</th>\n",
       "      <th>5</th>\n",
       "      <th>6</th>\n",
       "      <th>7</th>\n",
       "      <th>8</th>\n",
       "      <th>9</th>\n",
       "      <th>10</th>\n",
       "      <th>...</th>\n",
       "      <th>2418</th>\n",
       "      <th>2419</th>\n",
       "      <th>2420</th>\n",
       "      <th>2421</th>\n",
       "      <th>2422</th>\n",
       "      <th>2423</th>\n",
       "      <th>2424</th>\n",
       "      <th>2425</th>\n",
       "      <th>2426</th>\n",
       "      <th>2427</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>10 rows × 2427 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "0   1     2     3     4     5     6     7     8     9     10    ...  2418  \\\n",
       "1      0     0     0     0     0     0     0     0     0     0  ...     0   \n",
       "2      1     1     0     1     0     1     0     1     1     1  ...     0   \n",
       "3      0     0     0     0     0     0     0     0     0     0  ...     0   \n",
       "4      0     0     1     0     0     0     0     0     0     0  ...     0   \n",
       "5      0     0     0     0     0     0     0     0     0     0  ...     0   \n",
       "6      0     0     0     0     0     0     0     0     0     0  ...     0   \n",
       "7      0     0     0     0     0     0     0     0     0     0  ...     0   \n",
       "8      0     0     0     0     0     0     0     0     0     0  ...     0   \n",
       "9      0     0     0     0     0     0     0     0     0     0  ...     0   \n",
       "10     0     0     0     0     0     0     1     0     0     0  ...     0   \n",
       "\n",
       "0   2419  2420  2421  2422  2423  2424  2425  2426  2427  \n",
       "1      0     0     0     0     0     0     0     0     0  \n",
       "2      0     0     0     0     0     0     0     0     0  \n",
       "3      0     0     0     0     0     0     0     0     0  \n",
       "4      0     0     0     0     0     0     0     0     0  \n",
       "5      1     0     0     0     0     0     0     0     0  \n",
       "6      0     0     0     0     0     0     0     0     0  \n",
       "7      0     0     0     0     0     0     0     0     0  \n",
       "8      0     0     0     0     0     0     0     0     0  \n",
       "9      0     0     0     0     0     0     0     0     0  \n",
       "10     0     0     0     0     0     0     0     0     0  \n",
       "\n",
       "[10 rows x 2427 columns]"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Делаю шапку по количеству персонала\n",
    "#добавил колонку от 1 до n сотрудников\n",
    "col_all = p_lvl.reset_index()\n",
    "#удалил лишнее\n",
    "col_all = col_all.drop(col_all.columns[[1, 2]], axis=1)\n",
    "col_all = col_all.rename(columns={'index': 0})\n",
    "#новая шапка \n",
    "col_all = col_all.T\n",
    "#соединяю новую шапку и таблицу и таблицу с квалификациями\n",
    "q_fied = [col_all, q_fied]\n",
    "q_fied = pd.concat(q_fied)\n",
    "#переназначил новую колонку\n",
    "q_fied.columns = q_fied.iloc[0]\n",
    "#удалил лишнюю строку\n",
    "q_fied = q_fied.reindex(q_fied.index.drop(0))\n",
    "#Готово\n",
    "q_fied"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [],
   "source": [
    "q_fied_tot = q_fied.copy()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Определяю количество квалификаций у каждого человека\n",
    "q_fied_tot.loc['Total']= q_fied_tot.sum(numeric_only=True, axis=0)\n",
    "#Определяю наиболее востребованные квалификации\n",
    "q_fied_tot.loc[:,'Row_Total'] = q_fied_tot.sum(numeric_only=True, axis=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>1</th>\n",
       "      <th>2</th>\n",
       "      <th>3</th>\n",
       "      <th>4</th>\n",
       "      <th>5</th>\n",
       "      <th>6</th>\n",
       "      <th>7</th>\n",
       "      <th>8</th>\n",
       "      <th>9</th>\n",
       "      <th>10</th>\n",
       "      <th>...</th>\n",
       "      <th>2419</th>\n",
       "      <th>2420</th>\n",
       "      <th>2421</th>\n",
       "      <th>2422</th>\n",
       "      <th>2423</th>\n",
       "      <th>2424</th>\n",
       "      <th>2425</th>\n",
       "      <th>2426</th>\n",
       "      <th>2427</th>\n",
       "      <th>Row_Total</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>509</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>190</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>145</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>169</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>148</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>570</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>119</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>107</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>90</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>138</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Total</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>...</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2185</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>11 rows × 2428 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "0      1  2  3  4  5  6  7  8  9  10  ...  2419  2420  2421  2422  2423  2424  \\\n",
       "1      0  0  0  0  0  0  0  0  0   0  ...     0     0     0     0     0     0   \n",
       "2      1  1  0  1  0  1  0  1  1   1  ...     0     0     0     0     0     0   \n",
       "3      0  0  0  0  0  0  0  0  0   0  ...     0     0     0     0     0     0   \n",
       "4      0  0  1  0  0  0  0  0  0   0  ...     0     0     0     0     0     0   \n",
       "5      0  0  0  0  0  0  0  0  0   0  ...     1     0     0     0     0     0   \n",
       "6      0  0  0  0  0  0  0  0  0   0  ...     0     0     0     0     0     0   \n",
       "7      0  0  0  0  0  0  0  0  0   0  ...     0     0     0     0     0     0   \n",
       "8      0  0  0  0  0  0  0  0  0   0  ...     0     0     0     0     0     0   \n",
       "9      0  0  0  0  0  0  0  0  0   0  ...     0     0     0     0     0     0   \n",
       "10     0  0  0  0  0  0  1  0  0   0  ...     0     0     0     0     0     0   \n",
       "Total  1  1  1  1  0  1  1  1  1   1  ...     1     0     0     0     0     0   \n",
       "\n",
       "0      2425  2426  2427  Row_Total  \n",
       "1         0     0     0        509  \n",
       "2         0     0     0        190  \n",
       "3         0     0     0        145  \n",
       "4         0     0     0        169  \n",
       "5         0     0     0        148  \n",
       "6         0     0     0        570  \n",
       "7         0     0     0        119  \n",
       "8         0     0     0        107  \n",
       "9         0     0     0         90  \n",
       "10        0     0     0        138  \n",
       "Total     0     0     0       2185  \n",
       "\n",
       "[11 rows x 2428 columns]"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Общая таблица\n",
    "q_fied_tot"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>q_numb</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>509</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>190</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>145</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>169</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>148</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>570</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>119</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>107</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>90</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>138</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    q_numb\n",
       "1      509\n",
       "2      190\n",
       "3      145\n",
       "4      169\n",
       "5      148\n",
       "6      570\n",
       "7      119\n",
       "8      107\n",
       "9       90\n",
       "10     138"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#наиболее востребованные квалификаии\n",
    "q_rang = q_fied_tot['Row_Total']\n",
    "q_rang = q_rang.drop('Total', axis=0)\n",
    "q_rang = pd.DataFrame(q_rang)\n",
    "q_rang.columns = ['q_numb']\n",
    "q_rang"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>pers</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>Total</th>\n",
       "      <td>242</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       pers\n",
       "Total   242"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#количество неработающих сотрудников\n",
    "d_work = (q_fied_tot == 0).astype(int).sum(axis=1)\n",
    "d_work = pd.DataFrame(d_work, columns=['pers'])\n",
    "d_work = d_work.iloc[[-1]]\n",
    "d_work"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>pers</th>\n",
       "      <th>lvl</th>\n",
       "      <th>work_h</th>\n",
       "      <th>str</th>\n",
       "      <th>max_str</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>3401</td>\n",
       "      <td>70</td>\n",
       "      <td>80</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3402</td>\n",
       "      <td>70</td>\n",
       "      <td>80</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3404</td>\n",
       "      <td>1</td>\n",
       "      <td>80</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>3405</td>\n",
       "      <td>65</td>\n",
       "      <td>80</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>3407</td>\n",
       "      <td>55</td>\n",
       "      <td>90</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2423</th>\n",
       "      <td>104635</td>\n",
       "      <td>1</td>\n",
       "      <td>80</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2424</th>\n",
       "      <td>104638</td>\n",
       "      <td>1</td>\n",
       "      <td>80</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2425</th>\n",
       "      <td>104640</td>\n",
       "      <td>1</td>\n",
       "      <td>80</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2426</th>\n",
       "      <td>104641</td>\n",
       "      <td>1</td>\n",
       "      <td>80</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2427</th>\n",
       "      <td>104642</td>\n",
       "      <td>1</td>\n",
       "      <td>80</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2427 rows × 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        pers  lvl  work_h  str  max_str\n",
       "1       3401   70      80    3        3\n",
       "2       3402   70      80    1        1\n",
       "3       3404    1      80    2        2\n",
       "4       3405   65      80    2        2\n",
       "5       3407   55      90    2        2\n",
       "...      ...  ...     ...  ...      ...\n",
       "2423  104635    1      80    3        3\n",
       "2424  104638    1      80    3        3\n",
       "2425  104640    1      80    3        3\n",
       "2426  104641    1      80    3        3\n",
       "2427  104642    1      80    3        3\n",
       "\n",
       "[2427 rows x 5 columns]"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Объединяю информацию по персоналу\n",
    "pers_inf = pd.merge(p_lvl, max_f, left_index=True, right_index=True, how=\"left\")\n",
    "pers_inf = pd.merge(pers_inf, starts, left_index=True, right_index=True, how=\"left\")\n",
    "pers_inf = pd.merge(pers_inf, m_starts, left_index=True, right_index=True, how=\"left\")\n",
    "pers_inf"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>pers</th>\n",
       "      <th>m_1</th>\n",
       "      <th>m_2</th>\n",
       "      <th>m_3</th>\n",
       "      <th>m_4</th>\n",
       "      <th>m_5</th>\n",
       "      <th>m_6</th>\n",
       "      <th>m_7</th>\n",
       "      <th>m_8</th>\n",
       "      <th>m_9</th>\n",
       "      <th>m_10</th>\n",
       "      <th>m_11</th>\n",
       "      <th>m_12</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>3401</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3402</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3404</td>\n",
       "      <td>0</td>\n",
       "      <td>60</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>60</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>60</td>\n",
       "      <td>0</td>\n",
       "      <td>39</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>3405</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>3407</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2423</th>\n",
       "      <td>104635</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2424</th>\n",
       "      <td>104638</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2425</th>\n",
       "      <td>104640</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2426</th>\n",
       "      <td>104641</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2427</th>\n",
       "      <td>104642</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2427 rows × 13 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        pers  m_1  m_2  m_3  m_4  m_5  m_6  m_7  m_8  m_9  m_10  m_11  m_12\n",
       "1       3401    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "2       3402    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "3       3404    0   60    0    0   60    0    0   60    0    39     0     0\n",
       "4       3405    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "5       3407    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "...      ...  ...  ...  ...  ...  ...  ...  ...  ...  ...   ...   ...   ...\n",
       "2423  104635    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "2424  104638    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "2425  104640    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "2426  104641    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "2427  104642    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "\n",
       "[2427 rows x 13 columns]"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Желаемое время отпусков сотрудников по месцам\n",
    "wish_m = pd.merge(p_lvl, wishes, left_index=True, right_index=True, how=\"left\")\n",
    "wish_m = wish_m.drop('lvl',1)\n",
    "wish_m"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>pers</th>\n",
       "      <th>m_1</th>\n",
       "      <th>m_2</th>\n",
       "      <th>m_3</th>\n",
       "      <th>m_4</th>\n",
       "      <th>m_5</th>\n",
       "      <th>m_6</th>\n",
       "      <th>m_7</th>\n",
       "      <th>m_8</th>\n",
       "      <th>m_9</th>\n",
       "      <th>m_10</th>\n",
       "      <th>m_11</th>\n",
       "      <th>m_12</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>3401</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3402</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3404</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>3405</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>3407</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2423</th>\n",
       "      <td>104635</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2424</th>\n",
       "      <td>104638</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2425</th>\n",
       "      <td>104640</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2426</th>\n",
       "      <td>104641</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2427</th>\n",
       "      <td>104642</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2427 rows × 13 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        pers  m_1  m_2  m_3  m_4  m_5  m_6  m_7  m_8  m_9  m_10  m_11  m_12\n",
       "1       3401    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "2       3402    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "3       3404    0    3    0    0    3    0    0    1    0     3     0     0\n",
       "4       3405    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "5       3407    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "...      ...  ...  ...  ...  ...  ...  ...  ...  ...  ...   ...   ...   ...\n",
       "2423  104635    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "2424  104638    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "2425  104640    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "2426  104641    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "2427  104642    0    0    0    0    0    0    0    0    0     0     0     0\n",
       "\n",
       "[2427 rows x 13 columns]"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#приоритет \n",
    "r_prior_m = pd.merge(p_lvl, r_prior, left_index=True, right_index=True, how=\"left\")\n",
    "r_prior_m = r_prior_m.drop('lvl',1)\n",
    "r_prior_m"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [],
   "source": [
    "#затирать не хотел\n",
    "pers_inf_copy = pers_inf.copy()\n",
    "#максимальный уровень квалификаии (для формулы)\n",
    "max_lvl = pers_inf_copy['lvl'].max()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [],
   "source": [
    "applications = pd.DataFrame(columns = ['pers', 'month', 'score', 'req_rest'])\n",
    "n=0\n",
    "\n",
    "for index, row in r_prior_m.iterrows():\n",
    "    pers = row['pers']\n",
    "    for col in r_prior_m.columns:\n",
    "        if (row[col] > 0) & (col != 'pers'):\n",
    "            rating = (4 - row[col])*(max_lvl + 1) + \\\n",
    "                p_lvl.loc[p_lvl['pers'] == pers]['lvl'].iloc[0]\n",
    "            req_rest = wish_m.loc[wish_m['pers'] == pers][col].iloc[0]\n",
    "\n",
    "            applications.loc[n] = [pers, col.split('_')[1], rating, req_rest]\n",
    "            n += 1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>pers</th>\n",
       "      <th>month</th>\n",
       "      <th>score</th>\n",
       "      <th>req_rest</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>141</th>\n",
       "      <td>3606</td>\n",
       "      <td>4</td>\n",
       "      <td>343</td>\n",
       "      <td>78</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>222</th>\n",
       "      <td>4933</td>\n",
       "      <td>7</td>\n",
       "      <td>343</td>\n",
       "      <td>73</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1372</th>\n",
       "      <td>12522</td>\n",
       "      <td>4</td>\n",
       "      <td>343</td>\n",
       "      <td>78</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>973</th>\n",
       "      <td>12280</td>\n",
       "      <td>8</td>\n",
       "      <td>343</td>\n",
       "      <td>36</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>51</th>\n",
       "      <td>3486</td>\n",
       "      <td>8</td>\n",
       "      <td>343</td>\n",
       "      <td>92</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3166</th>\n",
       "      <td>95192</td>\n",
       "      <td>11</td>\n",
       "      <td>92</td>\n",
       "      <td>18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3165</th>\n",
       "      <td>95192</td>\n",
       "      <td>8</td>\n",
       "      <td>92</td>\n",
       "      <td>36</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3164</th>\n",
       "      <td>95192</td>\n",
       "      <td>6</td>\n",
       "      <td>92</td>\n",
       "      <td>34</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3163</th>\n",
       "      <td>95192</td>\n",
       "      <td>2</td>\n",
       "      <td>92</td>\n",
       "      <td>21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4566</th>\n",
       "      <td>104511</td>\n",
       "      <td>12</td>\n",
       "      <td>92</td>\n",
       "      <td>36</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>4567 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        pers month score req_rest\n",
       "141     3606     4   343       78\n",
       "222     4933     7   343       73\n",
       "1372   12522     4   343       78\n",
       "973    12280     8   343       36\n",
       "51      3486     8   343       92\n",
       "...      ...   ...   ...      ...\n",
       "3166   95192    11    92       18\n",
       "3165   95192     8    92       36\n",
       "3164   95192     6    92       34\n",
       "3163   95192     2    92       21\n",
       "4566  104511    12    92       36\n",
       "\n",
       "[4567 rows x 4 columns]"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "applications = applications.sort_values(by='score', ascending = False)\n",
    "applications"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>pers</th>\n",
       "      <th>lvl</th>\n",
       "      <th>work_h</th>\n",
       "      <th>str</th>\n",
       "      <th>max_str</th>\n",
       "      <th>m_1</th>\n",
       "      <th>m_2</th>\n",
       "      <th>m_3</th>\n",
       "      <th>m_4</th>\n",
       "      <th>m_5</th>\n",
       "      <th>m_6</th>\n",
       "      <th>m_7</th>\n",
       "      <th>m_8</th>\n",
       "      <th>m_9</th>\n",
       "      <th>m_10</th>\n",
       "      <th>m_11</th>\n",
       "      <th>m_12</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>3401</td>\n",
       "      <td>70</td>\n",
       "      <td>80</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>3402</td>\n",
       "      <td>70</td>\n",
       "      <td>80</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3404</td>\n",
       "      <td>1</td>\n",
       "      <td>80</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3405</td>\n",
       "      <td>65</td>\n",
       "      <td>80</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>3407</td>\n",
       "      <td>55</td>\n",
       "      <td>90</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2422</th>\n",
       "      <td>104635</td>\n",
       "      <td>1</td>\n",
       "      <td>80</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2423</th>\n",
       "      <td>104638</td>\n",
       "      <td>1</td>\n",
       "      <td>80</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2424</th>\n",
       "      <td>104640</td>\n",
       "      <td>1</td>\n",
       "      <td>80</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2425</th>\n",
       "      <td>104641</td>\n",
       "      <td>1</td>\n",
       "      <td>80</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2426</th>\n",
       "      <td>104642</td>\n",
       "      <td>1</td>\n",
       "      <td>80</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2427 rows × 17 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        pers  lvl  work_h  str  max_str  m_1  m_2  m_3  m_4  m_5  m_6  m_7  \\\n",
       "0       3401   70      80    3        3    0    0    0    0    0    0    0   \n",
       "1       3402   70      80    1        1    0    0    0    0    0    0    0   \n",
       "2       3404    1      80    2        2    0    3    0    0    3    0    0   \n",
       "3       3405   65      80    2        2    0    0    0    0    0    0    0   \n",
       "4       3407   55      90    2        2    0    0    0    0    0    0    0   \n",
       "...      ...  ...     ...  ...      ...  ...  ...  ...  ...  ...  ...  ...   \n",
       "2422  104635    1      80    3        3    0    0    0    0    0    0    0   \n",
       "2423  104638    1      80    3        3    0    0    0    0    0    0    0   \n",
       "2424  104640    1      80    3        3    0    0    0    0    0    0    0   \n",
       "2425  104641    1      80    3        3    0    0    0    0    0    0    0   \n",
       "2426  104642    1      80    3        3    0    0    0    0    0    0    0   \n",
       "\n",
       "      m_8  m_9  m_10  m_11  m_12  \n",
       "0       0    0     0     0     0  \n",
       "1       0    0     0     0     0  \n",
       "2       1    0     3     0     0  \n",
       "3       0    0     0     0     0  \n",
       "4       0    0     0     0     0  \n",
       "...   ...  ...   ...   ...   ...  \n",
       "2422    0    0     0     0     0  \n",
       "2423    0    0     0     0     0  \n",
       "2424    0    0     0     0     0  \n",
       "2425    0    0     0     0     0  \n",
       "2426    0    0     0     0     0  \n",
       "\n",
       "[2427 rows x 17 columns]"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#сцепляю сотрудников и приоритеты отпусков\n",
    "pers_prior = pers_inf_copy.merge(r_prior_m)\n",
    "pers_prior"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Модель и солвер"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "q_fied = q_fied.loc[:3]\n",
    "r_pers = r_pers.loc[:3]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "      <th>1</th>\n",
       "      <th>2</th>\n",
       "      <th>3</th>\n",
       "      <th>4</th>\n",
       "      <th>5</th>\n",
       "      <th>6</th>\n",
       "      <th>7</th>\n",
       "      <th>8</th>\n",
       "      <th>9</th>\n",
       "      <th>10</th>\n",
       "      <th>11</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>634</td>\n",
       "      <td>584</td>\n",
       "      <td>676</td>\n",
       "      <td>670</td>\n",
       "      <td>580</td>\n",
       "      <td>746</td>\n",
       "      <td>736</td>\n",
       "      <td>731</td>\n",
       "      <td>714</td>\n",
       "      <td>684</td>\n",
       "      <td>629</td>\n",
       "      <td>707</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>202</td>\n",
       "      <td>184</td>\n",
       "      <td>206</td>\n",
       "      <td>203</td>\n",
       "      <td>203</td>\n",
       "      <td>186</td>\n",
       "      <td>202</td>\n",
       "      <td>202</td>\n",
       "      <td>194</td>\n",
       "      <td>196</td>\n",
       "      <td>173</td>\n",
       "      <td>183</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>202</td>\n",
       "      <td>184</td>\n",
       "      <td>206</td>\n",
       "      <td>203</td>\n",
       "      <td>203</td>\n",
       "      <td>186</td>\n",
       "      <td>202</td>\n",
       "      <td>202</td>\n",
       "      <td>194</td>\n",
       "      <td>196</td>\n",
       "      <td>173</td>\n",
       "      <td>183</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    0    1    2    3    4    5    6    7    8    9    10   11\n",
       "1  634  584  676  670  580  746  736  731  714  684  629  707\n",
       "2  202  184  206  203  203  186  202  202  194  196  173  183\n",
       "3  202  184  206  203  203  186  202  202  194  196  173  183"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "qual_hours = q_fied.T.mul(pers_inf_copy.work_h, axis=0)\n",
    "zeros_mask = (qual_hours != 0).any(axis=1)\n",
    "qual_hours = qual_hours[zeros_mask]\n",
    "\n",
    "# Сокращу для теста\n",
    "r_pers = r_pers/50\n",
    "r_pers = r_pers.astype('int64')\n",
    "qual_hours = qual_hours.sample(frac = 0.1)\n",
    "r_pers"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [],
   "source": [
    " # Create the mip solver with the SCIP backend.\n",
    "solver = pywraplp.Solver.CreateSolver('SCIP')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Variables\n",
    "# x[1,2] - worker 1 assigned to month 2\n",
    "x = {}\n",
    "for i in qual_hours.index.unique():\n",
    "    for j in r_pers.columns:\n",
    "        x[(i,j)] = solver.IntVar(0, 1, 'x_%i_%i' % (i, j))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Constraints\n",
    "# Sum of qualification hours every month doesnt exceed the month reqs\n",
    "for j in r_pers.columns:\n",
    "    for m in r_pers.index.unique():\n",
    "        solver.Add(\n",
    "            sum(x[(i, j)] * qual_hours.loc[i, m] for i in qual_hours.index.unique()) >= \n",
    "                r_pers.loc[m,j]\n",
    "        )\n",
    "    \n",
    "# # Sum of hours worker work can exceed his limit\n",
    "# for j in data['workers']:\n",
    "#     solver.Add(\n",
    "#         sum(x[(i, j)] * data['worker_hours'][i] for i in data['workers']) <= \n",
    "#         data['worker_hours'][j])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Int64Index([1, 2, 3], dtype='int64')"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "qualifications = r_pers.index.unique()\n",
    "qualifications"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [],
   "source": [
    "# obj_func = solver.Sum([x[(i, j)] * data['worker_hours'][i] \\\n",
    "#         for i in data['workers'] for j in data['months']])/sum(data['month_reqs'])\n",
    "# solver.Minimize(obj_func)\n",
    "\n",
    "obj_func = solver.Sum([x[(i, j)] * qual_hours.loc[i, m] \\\n",
    "            for i in qual_hours.index.unique() for j in r_pers.columns \\\n",
    "                       for m in qualifications])/sum(r_pers.loc[m])\n",
    "\n",
    "# m = 3\n",
    "# obj_func = solver.Sum([x[(i, j)] * qual_hours.loc[i, m] \\\n",
    "#             for i in qual_hours.index.unique() for j in r_pers.columns])/sum(r_pers.loc[m])\n",
    "\n",
    "solver.Minimize(obj_func)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [],
   "source": [
    "total_req_hours = {}\n",
    "total_assigned_hours = {}\n",
    "\n",
    "for m in qualifications:\n",
    "    total_req_hours[m] = 0\n",
    "    total_assigned_hours[m] = 0\n",
    "    \n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [],
   "source": [
    "timetable = pd.DataFrame(1, index=qual_hours.index, columns=[0,1,2,3,4,5,6,7,8,9,10,11])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [],
   "source": [
    "timetable = timetable.mul(pers_inf_copy[pers_inf_copy.index.isin(qual_hours.index)].work_h, axis=0)\n",
    "#timetable['pers'] = p_lvl['pers']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "84"
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "len(timetable)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Month number 0\n",
      "  Квалификация  1\n",
      "    Назначенные работники:8 [1552, 1195, 1086, 1617, 1450, 399, 220, 1437]\n",
      "    Нужно часов в месяце: 634\n",
      "    Присвоено часов в месяце: 640\n",
      "    Процент: 1.0094637223974763\n",
      "\n",
      "  Квалификация  2\n",
      "    Назначенные работники:3 [74, 121, 520]\n",
      "    Нужно часов в месяце: 202\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.188118811881188\n",
      "\n",
      "  Квалификация  3\n",
      "    Назначенные работники:3 [452, 900, 1134]\n",
      "    Нужно часов в месяце: 202\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.188118811881188\n",
      "\n",
      "Время для отпуска:  82 \n",
      "\n",
      "Month number 1\n",
      "  Квалификация  1\n",
      "    Назначенные работники:8 [495, 382, 1086, 1617, 1450, 399, 220, 1437]\n",
      "    Нужно часов в месяце: 584\n",
      "    Присвоено часов в месяце: 620\n",
      "    Процент: 1.0616438356164384\n",
      "\n",
      "  Квалификация  2\n",
      "    Назначенные работники:3 [74, 121, 520]\n",
      "    Нужно часов в месяце: 184\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.3043478260869565\n",
      "\n",
      "  Квалификация  3\n",
      "    Назначенные работники:3 [452, 900, 1134]\n",
      "    Нужно часов в месяце: 184\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.3043478260869565\n",
      "\n",
      "Время для отпуска:  148 \n",
      "\n",
      "Month number 2\n",
      "  Квалификация  1\n",
      "    Назначенные работники:9 [495, 382, 1195, 1086, 1617, 1450, 399, 220, 1437]\n",
      "    Нужно часов в месяце: 676\n",
      "    Присвоено часов в месяце: 700\n",
      "    Процент: 1.0355029585798816\n",
      "\n",
      "  Квалификация  2\n",
      "    Назначенные работники:3 [74, 121, 520]\n",
      "    Нужно часов в месяце: 206\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.1650485436893203\n",
      "\n",
      "  Квалификация  3\n",
      "    Назначенные работники:3 [452, 900, 1134]\n",
      "    Нужно часов в месяце: 206\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.1650485436893203\n",
      "\n",
      "Время для отпуска:  92 \n",
      "\n",
      "Month number 3\n",
      "  Квалификация  1\n",
      "    Назначенные работники:9 [495, 382, 1195, 1086, 1617, 1450, 399, 220, 1437]\n",
      "    Нужно часов в месяце: 670\n",
      "    Присвоено часов в месяце: 700\n",
      "    Процент: 1.044776119402985\n",
      "\n",
      "  Квалификация  2\n",
      "    Назначенные работники:3 [74, 121, 520]\n",
      "    Нужно часов в месяце: 203\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.1822660098522169\n",
      "\n",
      "  Квалификация  3\n",
      "    Назначенные работники:3 [452, 900, 1134]\n",
      "    Нужно часов в месяце: 203\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.1822660098522169\n",
      "\n",
      "Время для отпуска:  104 \n",
      "\n",
      "Month number 4\n",
      "  Квалификация  1\n",
      "    Назначенные работники:8 [495, 382, 1086, 1617, 1450, 399, 220, 1437]\n",
      "    Нужно часов в месяце: 580\n",
      "    Присвоено часов в месяце: 620\n",
      "    Процент: 1.0689655172413792\n",
      "\n",
      "  Квалификация  2\n",
      "    Назначенные работники:3 [74, 121, 520]\n",
      "    Нужно часов в месяце: 203\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.1822660098522169\n",
      "\n",
      "  Квалификация  3\n",
      "    Назначенные работники:3 [452, 900, 1134]\n",
      "    Нужно часов в месяце: 203\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.1822660098522169\n",
      "\n",
      "Время для отпуска:  114 \n",
      "\n",
      "Month number 5\n",
      "  Квалификация  1\n",
      "    Назначенные работники:10 [495, 382, 1552, 1195, 1086, 1617, 1450, 399, 220, 1437]\n",
      "    Нужно часов в месяце: 746\n",
      "    Присвоено часов в месяце: 780\n",
      "    Процент: 1.0455764075067024\n",
      "\n",
      "  Квалификация  2\n",
      "    Назначенные работники:3 [74, 121, 520]\n",
      "    Нужно часов в месяце: 186\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.2903225806451613\n",
      "\n",
      "  Квалификация  3\n",
      "    Назначенные работники:3 [452, 900, 1134]\n",
      "    Нужно часов в месяце: 186\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.2903225806451613\n",
      "\n",
      "Время для отпуска:  142 \n",
      "\n",
      "Month number 6\n",
      "  Квалификация  1\n",
      "    Назначенные работники:10 [495, 382, 1552, 1195, 1086, 1617, 1450, 399, 220, 1437]\n",
      "    Нужно часов в месяце: 736\n",
      "    Присвоено часов в месяце: 780\n",
      "    Процент: 1.059782608695652\n",
      "\n",
      "  Квалификация  2\n",
      "    Назначенные работники:3 [74, 121, 520]\n",
      "    Нужно часов в месяце: 202\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.188118811881188\n",
      "\n",
      "  Квалификация  3\n",
      "    Назначенные работники:3 [452, 900, 1134]\n",
      "    Нужно часов в месяце: 202\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.188118811881188\n",
      "\n",
      "Время для отпуска:  120 \n",
      "\n",
      "Month number 7\n",
      "  Квалификация  1\n",
      "    Назначенные работники:10 [495, 382, 1552, 1195, 1086, 1617, 1450, 399, 220, 1437]\n",
      "    Нужно часов в месяце: 731\n",
      "    Присвоено часов в месяце: 780\n",
      "    Процент: 1.06703146374829\n",
      "\n",
      "  Квалификация  2\n",
      "    Назначенные работники:3 [74, 121, 520]\n",
      "    Нужно часов в месяце: 202\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.188118811881188\n",
      "\n",
      "  Квалификация  3\n",
      "    Назначенные работники:3 [452, 900, 1134]\n",
      "    Нужно часов в месяце: 202\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.188118811881188\n",
      "\n",
      "Время для отпуска:  125 \n",
      "\n",
      "Month number 8\n",
      "  Квалификация  1\n",
      "    Назначенные работники:9 [1746, 1552, 1195, 1086, 1617, 1450, 399, 220, 1437]\n",
      "    Нужно часов в месяце: 714\n",
      "    Присвоено часов в месяце: 720\n",
      "    Процент: 1.0084033613445378\n",
      "\n",
      "  Квалификация  2\n",
      "    Назначенные работники:3 [74, 121, 520]\n",
      "    Нужно часов в месяце: 194\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.2371134020618557\n",
      "\n",
      "  Квалификация  3\n",
      "    Назначенные работники:3 [452, 900, 1134]\n",
      "    Нужно часов в месяце: 194\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.2371134020618557\n",
      "\n",
      "Время для отпуска:  98 \n",
      "\n",
      "Month number 9\n",
      "  Квалификация  1\n",
      "    Назначенные работники:9 [495, 382, 1195, 1086, 1617, 1450, 399, 220, 1437]\n",
      "    Нужно часов в месяце: 684\n",
      "    Присвоено часов в месяце: 700\n",
      "    Процент: 1.023391812865497\n",
      "\n",
      "  Квалификация  2\n",
      "    Назначенные работники:3 [74, 121, 520]\n",
      "    Нужно часов в месяце: 196\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.2244897959183674\n",
      "\n",
      "  Квалификация  3\n",
      "    Назначенные работники:3 [452, 900, 1134]\n",
      "    Нужно часов в месяце: 196\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.2244897959183674\n",
      "\n",
      "Время для отпуска:  104 \n",
      "\n",
      "Month number 10\n",
      "  Квалификация  1\n",
      "    Назначенные работники:8 [382, 1195, 1086, 1617, 1450, 399, 220, 1437]\n",
      "    Нужно часов в месяце: 629\n",
      "    Присвоено часов в месяце: 630\n",
      "    Процент: 1.0015898251192368\n",
      "\n",
      "  Квалификация  2\n",
      "    Назначенные работники:2 [590, 592]\n",
      "    Нужно часов в месяце: 173\n",
      "    Присвоено часов в месяце: 180\n",
      "    Процент: 1.0404624277456647\n",
      "\n",
      "  Квалификация  3\n",
      "    Назначенные работники:2 [147, 1038]\n",
      "    Нужно часов в месяце: 173\n",
      "    Присвоено часов в месяце: 180\n",
      "    Процент: 1.0404624277456647\n",
      "\n",
      "Время для отпуска:  15 \n",
      "\n",
      "Month number 11\n",
      "  Квалификация  1\n",
      "    Назначенные работники:9 [382, 1552, 1195, 1086, 1617, 1450, 399, 220, 1437]\n",
      "    Нужно часов в месяце: 707\n",
      "    Присвоено часов в месяце: 710\n",
      "    Процент: 1.0042432814710043\n",
      "\n",
      "  Квалификация  2\n",
      "    Назначенные работники:3 [74, 121, 520]\n",
      "    Нужно часов в месяце: 183\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.3114754098360655\n",
      "\n",
      "  Квалификация  3\n",
      "    Назначенные работники:3 [452, 900, 1134]\n",
      "    Нужно часов в месяце: 183\n",
      "    Присвоено часов в месяце: 240\n",
      "    Процент: 1.3114754098360655\n",
      "\n",
      "Время для отпуска:  117 \n",
      "\n",
      "\n",
      "Time =  330  milliseconds\n",
      "\n",
      "***100% задач обеспечены ресурсами***\n"
     ]
    }
   ],
   "source": [
    "status = solver.Solve()\n",
    "\n",
    "holidays_time = {}\n",
    "\n",
    "if status == pywraplp.Solver.OPTIMAL:\n",
    "    num_months = 0\n",
    "    all_tasks_completed = False\n",
    "    \n",
    "    \n",
    "    for j in r_pers.columns:\n",
    "        print('Month number', j)\n",
    "        holidays_time[j] = 0\n",
    "        \n",
    "        for m in qualifications:\n",
    "            print ('  Квалификация ', m)\n",
    "            month_workers = []\n",
    "            month_assigned_hours = 0\n",
    "\n",
    "\n",
    "            for i in qual_hours.index.unique():\n",
    "                if x[i, j].solution_value() > 0:\n",
    "                    if qual_hours.loc[i, m] >0:\n",
    "                        month_workers.append(i)\n",
    "                        month_assigned_hours += qual_hours.loc[i, m]\n",
    "                        timetable.loc[i, j] = timetable.loc[i, j]- qual_hours.loc[i, m]\n",
    "\n",
    "            if month_assigned_hours > 0:\n",
    "                num_months += 1\n",
    "                \n",
    "                print('    Назначенные работники:{0}'.format(len(month_workers)), \n",
    "                      month_workers)\n",
    "                print ('    Нужно часов в месяце:', \n",
    "                       r_pers.loc[m,j])\n",
    "                print('    Присвоено часов в месяце:', \n",
    "                      month_assigned_hours)\n",
    "                print('    Процент:', \n",
    "                      month_assigned_hours/r_pers.loc[m,j])\n",
    "\n",
    "                print()\n",
    "            \n",
    "            total_req_hours[m] += r_pers.loc[m,j]\n",
    "            total_assigned_hours[m] += month_assigned_hours\n",
    "            \n",
    "            if total_assigned_hours[m] >= total_req_hours[m]:\n",
    "                all_tasks_completed = True\n",
    "            holidays_time[j] += month_assigned_hours - r_pers.loc[m,j]\n",
    "        \n",
    "        print ('Время для отпуска: ',holidays_time[j],'\\n')\n",
    "            \n",
    "    print()\n",
    "\n",
    "    print('Time = ', solver.WallTime(), ' milliseconds')\n",
    "    print ()\n",
    "    if all_tasks_completed:\n",
    "        print ('***100% задач обеспечены ресурсами***')\n",
    "else:\n",
    "    print('The problem does not have an optimal solution.')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Распределение отпусков"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>pers</th>\n",
       "      <th>month</th>\n",
       "      <th>score</th>\n",
       "      <th>req_rest</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>141</th>\n",
       "      <td>3606</td>\n",
       "      <td>4</td>\n",
       "      <td>343</td>\n",
       "      <td>78</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>222</th>\n",
       "      <td>4933</td>\n",
       "      <td>7</td>\n",
       "      <td>343</td>\n",
       "      <td>73</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1372</th>\n",
       "      <td>12522</td>\n",
       "      <td>4</td>\n",
       "      <td>343</td>\n",
       "      <td>78</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>973</th>\n",
       "      <td>12280</td>\n",
       "      <td>8</td>\n",
       "      <td>343</td>\n",
       "      <td>36</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>51</th>\n",
       "      <td>3486</td>\n",
       "      <td>8</td>\n",
       "      <td>343</td>\n",
       "      <td>92</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       pers month score req_rest\n",
       "141    3606     4   343       78\n",
       "222    4933     7   343       73\n",
       "1372  12522     4   343       78\n",
       "973   12280     8   343       36\n",
       "51     3486     8   343       92"
      ]
     },
     "execution_count": 30,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "applications.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Таблица запросов отпуска\n",
    "zeros_mask = (wishes != 0).any(axis=1)\n",
    "wishes = wishes[zeros_mask]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{0: 82,\n",
       " 1: 148,\n",
       " 2: 92,\n",
       " 3: 104,\n",
       " 4: 114,\n",
       " 5: 142,\n",
       " 6: 120,\n",
       " 7: 125,\n",
       " 8: 98,\n",
       " 9: 104,\n",
       " 10: 15,\n",
       " 11: 117}"
      ]
     },
     "execution_count": 32,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "holidays_time"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "metadata": {},
   "outputs": [],
   "source": [
    "pers_list = qual_hours.index.unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "metadata": {},
   "outputs": [],
   "source": [
    " # Create the mip solver with the SCIP backend.\n",
    "solver = pywraplp.Solver.CreateSolver('SCIP')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Variables\n",
    "# x[1,2] - worker 1 gets vacations in month 2\n",
    "x_vac = {}\n",
    "for index, row in applications.iterrows():\n",
    "    pers = row['pers']\n",
    "    for month in applications[applications['pers'] == pers]['month'].unique():\n",
    "        x_vac[(pers,month)] = solver.IntVar(0, 1, 'x_{0}_{1}'.format(pers, month))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "for month in holidays_time.keys():\n",
    "    print ('Месяц ',month)\n",
    "    for pers in pers_list:\n",
    "        if x[pers, month].solution_value() > 0:\n",
    "            print ('   ',pers)"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {},
   "source": [
    "# Constraints\n",
    "# Sum of qualification hours every month doesnt exceed the month reqs\n",
    "for j in r_pers.columns:\n",
    "    for m in r_pers.index.unique():\n",
    "        solver.Add(\n",
    "            sum(x[(i, j)] * qual_hours.loc[i, m] for i in qual_hours.index.unique()) >= \n",
    "                r_pers.loc[m,j]\n",
    "        )\n",
    "    \n",
    "# # Sum of hours worker work can exceed his limit\n",
    "# for j in data['workers']:\n",
    "#     solver.Add(\n",
    "#         sum(x[(i, j)] * data['worker_hours'][i] for i in data['workers']) <= \n",
    "#         data['worker_hours'][j])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "80"
      ]
     },
     "execution_count": 36,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "max_f.work_h.loc[i]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "for j in r_pers.columns:\n",
    "    for m in r_pers.index.unique():\n",
    "        solver.Add(\n",
    "            sum(x[(i, j)] * qual_hours.loc[i, m] for i in qual_hours.index.unique()) >= \n",
    "                r_pers.loc[m,j]\n",
    "        )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Ограничения\n",
    "# 1. Общее время за год не может превосходить месячного лимита умноженного на 10\n",
    "\n",
    "months = list(timetable.columns)\n",
    "for j in r_pers.columns:\n",
    "    solver.Add(\n",
    "        sum(x[(i, j)] * max_f.work_h.loc[i] for i in qual_hours.index.unique()) <= \n",
    "        100\n",
    "    )\n",
    "\n",
    "# 2. Сумма работа + отпуск = месячный лимит\n",
    "\n",
    "# 3. Меньшая часть отпуск не может быть меньше 3х часов\n",
    "\n",
    "# 4. Не более 4х отпусков каждому сотруднику TOTAL_RESTS\n",
    "\n",
    "# 5. Минимальный размер отпуска в часах MIN_REST_SIZE\n",
    "\n",
    "# 6. Суммарный максимальный объем отпусков в часах REST_YEAR\n",
    "\n",
    "# 7. Разрыв между отпусками менее MIN_REST_LAG не может быть\n",
    "\n",
    "# 8. Количество отпусков в топовые месяцы <= PRIOR_RESTS\n",
    "\n",
    "# 9. Количество отпусков в нетоповые месяцы <= NOPRIOR_RESTS\n",
    "\n",
    "# 10. Суммарно количество отпусков в топовые месяцы не может превосходить REST_HIGH\n",
    "\n",
    "# 11.Суммарно количество отпусков в нетоповые месяцы не может превосходить REST_LOW"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 54,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Целевая функция\n",
    "# 1. Максимальное удовлетворение запросов на рабочие часы (минимум неудовлетворения часов)\n",
    "# 2. Максимальная раздача отпусков в оставшиеся часы\n",
    "# 3. Максимальное удовлетворение заявок (не по размерам, а по факту назначения отпуска в месяц заявки)\n",
    "# 4. Максимальный суммарный рейтинг заявок, удовлетворенных в п.3"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "x_1394_0\n",
      "x_1394_1\n",
      "x_1394_2\n",
      "x_1394_3\n",
      "x_1394_4\n",
      "x_1394_5\n",
      "x_1394_6\n",
      "x_1394_7\n",
      "x_1394_8\n",
      "x_1394_9\n",
      "x_1394_11\n",
      "x_99_0\n",
      "x_99_1\n",
      "x_99_2\n",
      "x_99_3\n",
      "x_99_4\n",
      "x_99_5\n",
      "x_99_6\n",
      "x_99_7\n",
      "x_99_8\n",
      "x_99_9\n",
      "x_99_11\n",
      "x_1062_1\n",
      "x_1062_2\n",
      "x_1062_3\n",
      "x_1062_4\n",
      "x_1062_5\n",
      "x_1062_6\n",
      "x_1062_7\n",
      "x_1062_9\n",
      "x_349_0\n",
      "x_349_1\n",
      "x_349_2\n",
      "x_349_3\n",
      "x_349_4\n",
      "x_349_5\n",
      "x_349_6\n",
      "x_349_7\n",
      "x_349_8\n",
      "x_349_9\n",
      "x_349_11\n",
      "x_180_0\n",
      "x_180_1\n",
      "x_180_2\n",
      "x_180_3\n",
      "x_180_4\n",
      "x_180_5\n",
      "x_180_6\n",
      "x_180_7\n",
      "x_180_8\n",
      "x_180_9\n",
      "x_180_11\n",
      "x_1953_8\n",
      "x_283_1\n",
      "x_283_2\n",
      "x_283_3\n",
      "x_283_4\n",
      "x_283_5\n",
      "x_283_6\n",
      "x_283_7\n",
      "x_283_9\n",
      "x_283_10\n",
      "x_283_11\n",
      "x_1746_0\n",
      "x_1746_5\n",
      "x_1746_6\n",
      "x_1746_7\n",
      "x_1746_8\n",
      "x_1746_11\n",
      "x_510_0\n",
      "x_510_2\n",
      "x_510_3\n",
      "x_510_5\n",
      "x_510_6\n",
      "x_510_7\n",
      "x_510_8\n",
      "x_510_9\n",
      "x_510_10\n",
      "x_510_11\n",
      "x_227_0\n",
      "x_227_1\n",
      "x_227_2\n",
      "x_227_3\n",
      "x_227_4\n",
      "x_227_5\n",
      "x_227_6\n",
      "x_227_7\n",
      "x_227_8\n",
      "x_227_9\n",
      "x_227_10\n",
      "x_227_11\n",
      "x_77_0\n",
      "x_77_1\n",
      "x_77_2\n",
      "x_77_3\n",
      "x_77_4\n",
      "x_77_5\n",
      "x_77_6\n",
      "x_77_7\n",
      "x_77_8\n",
      "x_77_9\n",
      "x_77_11\n",
      "x_213_0\n",
      "x_213_1\n",
      "x_213_2\n",
      "x_213_3\n",
      "x_213_4\n",
      "x_213_5\n",
      "x_213_6\n",
      "x_213_7\n",
      "x_213_8\n",
      "x_213_9\n",
      "x_213_10\n",
      "x_213_11\n",
      "x_974_10\n",
      "x_1352_10\n",
      "x_97_10\n",
      "x_1555_0\n",
      "x_1555_1\n",
      "x_1555_2\n",
      "x_1555_3\n",
      "x_1555_4\n",
      "x_1555_5\n",
      "x_1555_6\n",
      "x_1555_7\n",
      "x_1555_8\n",
      "x_1555_9\n",
      "x_1555_10\n",
      "x_1555_11\n",
      "x_37_0\n",
      "x_37_1\n",
      "x_37_2\n",
      "x_37_3\n",
      "x_37_4\n",
      "x_37_5\n",
      "x_37_6\n",
      "x_37_7\n",
      "x_37_8\n",
      "x_37_9\n",
      "x_37_11\n",
      "x_164_10\n",
      "x_333_0\n",
      "x_333_1\n",
      "x_333_2\n",
      "x_333_3\n",
      "x_333_4\n",
      "x_333_5\n",
      "x_333_6\n",
      "x_333_7\n",
      "x_333_8\n",
      "x_333_9\n",
      "x_333_10\n",
      "x_333_11\n",
      "x_1729_0\n",
      "x_1729_1\n",
      "x_1729_2\n",
      "x_1729_3\n",
      "x_1729_4\n",
      "x_1729_5\n",
      "x_1729_6\n",
      "x_1729_7\n",
      "x_1729_8\n",
      "x_1729_9\n",
      "x_1729_10\n",
      "x_1729_11\n",
      "x_1532_0\n",
      "x_1532_1\n",
      "x_1532_2\n",
      "x_1532_3\n",
      "x_1532_4\n",
      "x_1532_5\n",
      "x_1532_6\n",
      "x_1532_7\n",
      "x_1532_8\n",
      "x_1532_9\n",
      "x_1532_10\n",
      "x_1532_11\n"
     ]
    }
   ],
   "source": [
    "for i in qual_hours.index.unique():\n",
    "    for j in r_pers.columns:\n",
    "        if x[i, j].solution_value() > 0:\n",
    "            print (x[i, j])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 42,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>1</th>\n",
       "      <th>2</th>\n",
       "      <th>3</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0</td>\n",
       "      <td>80</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>80</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>80</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2423</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2424</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2425</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2426</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2427</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2427 rows × 3 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "      1   2  3\n",
       "0             \n",
       "1     0  80  0\n",
       "2     0  80  0\n",
       "3     0   0  0\n",
       "4     0  80  0\n",
       "5     0   0  0\n",
       "...  ..  .. ..\n",
       "2423  0   0  0\n",
       "2424  0   0  0\n",
       "2425  0   0  0\n",
       "2426  0   0  0\n",
       "2427  0   0  0\n",
       "\n",
       "[2427 rows x 3 columns]"
      ]
     },
     "execution_count": 42,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "q_fied.T.mul(pers_inf_copy.work_h, axis=0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 49,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>1</th>\n",
       "      <th>2</th>\n",
       "      <th>3</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>37</th>\n",
       "      <td>0</td>\n",
       "      <td>80</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>41</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>80</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>66</th>\n",
       "      <td>0</td>\n",
       "      <td>80</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>77</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>80</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>93</th>\n",
       "      <td>0</td>\n",
       "      <td>80</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2170</th>\n",
       "      <td>80</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2188</th>\n",
       "      <td>80</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2234</th>\n",
       "      <td>80</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2237</th>\n",
       "      <td>80</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2250</th>\n",
       "      <td>80</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>84 rows × 3 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "       1   2   3\n",
       "0               \n",
       "37     0  80   0\n",
       "41     0   0  80\n",
       "66     0  80   0\n",
       "77     0   0  80\n",
       "93     0  80   0\n",
       "...   ..  ..  ..\n",
       "2170  80   0   0\n",
       "2188  80   0   0\n",
       "2234  80   0   0\n",
       "2237  80   0   0\n",
       "2250  80   0   0\n",
       "\n",
       "[84 rows x 3 columns]"
      ]
     },
     "execution_count": 49,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "qual_hours.sort_index()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
